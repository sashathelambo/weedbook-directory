<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vendor Page</title>
    <link rel="shortcut icon" href="public/images/weedbook.png" type="image/x-icon" />
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #ebf0f2;
            color: #2d3748;
            text-align: center;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        header {
            background: linear-gradient(135deg, #3182ce, #2c5282);
            color: white;
            padding: 1rem 0;
            /* border-radius: 0.5rem; */
            margin-bottom: 1.5rem;
        }
        
        footer {
            background: linear-gradient(135deg, #3182ce, #2c5282);
            color: white;
            padding: 1rem 0;
            border-radius: 0.5rem;
            margin-top: 1.5rem;
        }
        
        .vendor {
            background-color: #fff;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
            padding: 1rem;
            border: 2px solid #2c5282;
            transition: transform 0.3s ease, box-shadow 0.3s ease, opacity 0.3s ease;
            cursor: pointer;
        }
        
        .vendor:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }
        
        .hidden {
            display: none;
        }
        
        .flex {
            display: flex;
        }
        
        .items-center {
            align-items: center;
        }
        
        .justify-between {
            justify-content: space-between;
        }
        
        .space-x-2>*+* {
            margin-left: 0.5rem;
        }
        /* Ensure dropdown menu fits within container */
        
        .dropdown-container {
            position: relative;
            display: inline-block;
            width: 100%;
        }
        
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 100%;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            z-index: 1;
        }
        
        .dropdown-container:hover .dropdown-content {
            display: block;
        }
        
        .dropdown-content select {
            width: 100%;
            box-sizing: border-box;
        }
        /* Dark mode styles */
        
        .dark-mode {
            background-color: #2d3748;
            color: #ebf0f2;
        }
        
        .dark-mode header,
        .dark-mode footer {
            background: linear-gradient(135deg, #2c5282, #3182ce);
        }
        
        .dark-mode .vendor {
            background-color: #2d3748;
            color: #ebf0f2;
            border: 2px solid #3182ce;
        }
        
        .dark-mode .dropdown-content {
            background-color: #2d3748;
            color: #ebf0f2;
        }
        /* Smooth scrolling */
        
        html {
            scroll-behavior: smooth;
        }
        /* Transition for vendor elements */
        
        .vendor.hidden {
            opacity: 0;
            transform: translateY(20px);
        }
        
        .vendor.visible {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>

<body class="flex flex-col min-h-screen bg-gray-100">
    <header>
        <div class="container flex justify-between items-center">
            <h1 class="text-2xl font-bold">Vendor Page</h1>
            <div class="flex items-center justify-center">
                <a href="index.html" class="text-white hover:underline mr-4">Home</a>
                <button id="dark-mode-toggle" class="bg-gray-200 dark:bg-gray-800 px-2 py-1 rounded">ðŸŒ“</button>
            </div>
        </div>
    </header>

    <main class="container flex-grow py-8">
        <!-- Fields for user input at the top -->
        <section id="user-input-top" class="p-6">
            <h2 class="text-xl font-bold mb-6">Search Vendors</h2>
            <input type="text" id="vendor-search-top" placeholder="Search for a vendor..." class="w-full mb-4 p-2 border rounded">
            <div class="dropdown-container w-full mb-4 p-2 border rounded">
                <select id="vendor-category-top" class="w-full">
                    <option value="all">All Categories</option>
                    <option value="flower">Flower</option>
                    <option value="concentrates">Concentrates</option>
                    <option value="edibles">Edibles</option>
                    <option value="topicals">Topicals</option>
                    <option value="tinctures">Tinctures</option>
                    <option value="capsules">Capsules</option>
                    <option value="accessories">Accessories</option>
                </select>
            </div>
            <div class="dropdown-container w-full mb-4 p-2 border rounded">
                <select id="vendor-sort-top" class="w-full">
                    <option value="name">Sort by Name</option>
                    <option value="category">Sort by Category</option>
                </select>
            </div>
            <button id="reset-filters-top" class="bg-blue-500 text-white px-4 py-2 rounded">Reset Filters</button>
        </section>

        <section id="vendor-list" class="p-6">
            <h2 class="text-xl font-bold mb-6">Our Vendors</h2>
            <div id="vendors">
                Vendors will be dynamically added here </div>
        </section>

        <!-- Fields for user input at the bottom -->
        <section id="user-input-bottom" class="p-6">
            <h2 class="text-xl font-bold mb-6">Search Vendors</h2>
            <input type="text" id="vendor-search-bottom" placeholder="Search for a vendor..." class="w-full mb-4 p-2 border rounded">
            <div class="dropdown-container w-full mb-4 p-2 border rounded">
                <select id="vendor-category-bottom" class="w-full">
                    <option value="all">All Categories</option>
                    <option value="flower">Flower</option>
                    <option value="concentrates">Concentrates</option>
                    <option value="edibles">Edibles</option>
                    <option value="topicals">Topicals</option>
                    <option value="tinctures">Tinctures</option>
                    <option value="capsules">Capsules</option>
                    <option value="accessories">Accessories</option>
                </select>
            </div>
            <div class="dropdown-container w-full mb-4 p-2 border rounded">
                <select id="vendor-sort-bottom" class="w-full">
                    <option value="name">Sort by Name</option>
                    <option value="category">Sort by Category</option>
                </select>
            </div>
            <button id="reset-filters-bottom" class="bg-blue-500 text-white px-4 py-2 rounded">Reset Filters</button>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 Vendor Page</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const vendorsContainer = document.getElementById('vendors');
            const vendorSearchTop = document.getElementById('vendor-search-top');
            const vendorCategoryTop = document.getElementById('vendor-category-top');
            const vendorSortTop = document.getElementById('vendor-sort-top');
            const resetFiltersTop = document.getElementById('reset-filters-top');
            const vendorSearchBottom = document.getElementById('vendor-search-bottom');
            const vendorCategoryBottom = document.getElementById('vendor-category-bottom');
            const vendorSortBottom = document.getElementById('vendor-sort-bottom');
            const resetFiltersBottom = document.getElementById('reset-filters-bottom');

            let vendorData = [];

            fetch('VendorData.csv')
                .then(response => response.text())
                .then(data => {
                    const rows = data.split('\n');
                    rows.forEach((row, index) => {
                        if (index === 0) return;
                        const columns = row.split(',');
                        if (columns.length > 1) {
                            const vendor = {
                                name: columns[0],
                                link: columns[1],
                                coupons: columns[2] ? columns[2].split(', ') : [],
                                category: columns[3],
                                paymentMethods: columns[4] ? columns[4].split(', ') : []
                            };
                            vendorData.push(vendor);
                        }
                    });
                    vendorData.sort((a, b) => a.name.localeCompare(b.name));
                    displayVendors(vendorData);
                })
                .catch(error => console.error('Error fetching vendor data:', error));

            function displayVendors(vendors) {
                const fragment = document.createDocumentFragment();
                vendors.forEach(vendor => {
                    const vendorElement = document.createElement('div');
                    vendorElement.classList.add('vendor', 'hidden');
                    vendorElement.innerHTML = `
                        <div class="flex items-center justify-center">
                            <a href="${vendor.link}" target="_blank" class="text-black-500 hover:underline">${vendor.name}</a>
                        </div>
                        <div class="coupons">
                            ${vendor.coupons.length > 0 ? 'Coupons: ' + vendor.coupons.join(', ') : 'No coupons available'}
                        </div>
                    `;
                    fragment.appendChild(vendorElement);
                });
                vendorsContainer.innerHTML = '';
                vendorsContainer.appendChild(fragment);
                revealVendors();
            }

            function revealVendors() {
                const vendorElements = document.querySelectorAll('.vendor');
                vendorElements.forEach((vendor, index) => {
                    setTimeout(() => {
                        vendor.classList.remove('hidden');
                        vendor.classList.add('visible');
                    }, index * 100); // Stagger the reveal for each vendor
                });
            }

            // Debounce function to limit the rate of function calls
            function debounce(func, wait) {
                let timeout;
                return function(...args) {
                    clearTimeout(timeout);
                    timeout = setTimeout(() => func.apply(this, args), wait);
                };
            }

            function filterAndSortVendors() {
                const searchTerm = vendorSearchTop.value.toLowerCase();
                const selectedCategory = vendorCategoryTop.value;
                const sortBy = vendorSortTop.value;

                let filteredVendors = vendorData.filter(vendor => vendor.name.toLowerCase().includes(searchTerm));

                if (selectedCategory !== 'all') {
                    filteredVendors = filteredVendors.filter(vendor => vendor.category === selectedCategory);
                }

                filteredVendors.sort((a, b) => {
                    if (sortBy === 'name') {
                        return a.name.localeCompare(b.name);
                    } else if (sortBy === 'category') {
                        return a.category.localeCompare(b.category);
                    }
                });

                displayVendors(filteredVendors);
            }

            vendorSearchTop.addEventListener('input', debounce(filterAndSortVendors, 300));
            vendorCategoryTop.addEventListener('change', filterAndSortVendors);
            vendorSortTop.addEventListener('change', filterAndSortVendors);

            resetFiltersTop.addEventListener('click', function() {
                vendorSearchTop.value = '';
                vendorCategoryTop.value = 'all';
                vendorSortTop.value = 'name';
                displayVendors(vendorData);
            });

            const darkModeToggle = document.getElementById('dark-mode-toggle');
            darkModeToggle.addEventListener('click', function() {
                document.body.classList.toggle('dark-mode');
            });
        });
    </script>
</body>

</html>